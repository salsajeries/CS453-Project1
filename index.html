<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Instructor Textbook Validator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <style>
      body {
        margin: 20px;
      }
    </style>
  </head>
  <body>
    
    <!-- Input Section -->
    <div class="container text-center">
      <div class="row align-items-start">
        <div class="col">
          
          <h1 id="instructorInput">Instructor Input</h1>
          <form action="test_server.php" method="post">
            <p> Course: <input type="text" name="course" /> </p>
      
            <p> Book 1 Title: <input type="text" name="book1N" /> </p>
            <p> Book 1 Publisher: <input type="text" name="book1P" /> </p>
            <p> Book 1 Edition: <input type="text" name="book1E" /> </p>
            <p> Print Date: <input type="text" name="pd1" /> </p>
      
            <p> Book 2 Title: <input type="text" name="book2N" /> </p>
            <p> Book 2 Publisher: <input type="text" name="book2P" /> </p>
            <p> Book 2 Edition: <input type="text" name="book2E" /> </p>
            <p> Print Date: <input type="text" name="pd2" /> </p>
            <button type="button" class="btn btn-primary" onclick="addCourse(this.form)">Add Course and Books</button>
          </form>

        </div>
        <div class="col">

          <h1 id="studentInput">Student Input</h1>
          <form action="test_server.php" method="post">
            <p> Full Name: <input type="text" name="name"> </p>
            <p> Course: <input type="text" name="course"> </p>
      
            <p> Book 1 Title: <input type="text" name="book1N"> </p>
            <p> Book 1 Publisher: <input type="text" name="book1P"> </p>
            <p> Book 1 Edition: <input type="text" name="book1E" /> </p>
            <p> Print Date: <input type="text" name="pd1" /> </p>
      
            <p> Book 2 Title: <input type="text" name="book2N"> </p>
            <p> Book 2 Publisher: <input type="text" name="book2P"> </p>
            <p> Book 2 Edition: <input type="text" name="book2E" /> </p>
            <p> Print Date: <input type="text" name="pd2" /> </p>
            <button type="button" class="btn btn-primary" onclick="addStudent(this.form)">Add Student</button>
          </form>

        </div>
      </div>
    </div>

    <br><hr>
    <button type="button" class="btn btn-primary" onclick="validateTextbooks()">VALIDATE TEXTBOOKS</button>
    <hr><br>

    <!-- Display Section -->
    <h1 id="displayCourses">All Instuctor Courses and Books</h1>
    <div>
      <button type="button" class="btn btn-primary" onclick="clearCourses()">CLEAR</button>
      <button type="button" class="btn btn-primary" onclick="getAllCourses()">UPDATE</button>
      <div id="CourseList">Instuctor Courses and Books Here: </div>
    </div>

    <h1 id="displayStudents">All Students and Books:</h1>
    <div>
      <button type="button" class="btn btn-primary" onclick="clearStudents()">CLEAR</button>
      <button type="button" class="btn btn-primary" onclick="getAllStudents()">UPDATE</button>
      <div id="StudentList"> Students and Books: </div>
    </div>


    <script type="text/javascript">

      /* COURSE FUNCTIONS */

      // Clear all courses in the session
      // Calls getAllCourses() to refresh
      function clearCourses() {
        var request = new XMLHttpRequest();
        request.open("GET", "test_server.php?requestType=clearCourses");

        request.onreadystatechange = function () {
          if (request.readyState == 4 && request.status == 200) {
              getAllCourses();
          }
        };

        console.log(request);
        request.send();
      }

      // Get all courses in courseArray list
      function getAllCourses() {
        var request = new XMLHttpRequest();
        
        request.onreadystatechange = function () {
          if (request.readyState === 4 && request.status === 200) {
            // Parse the JSON response
            var coursesArray = JSON.parse(request.responseText);

            // Now you can work with the coursesArray as needed
            console.log(coursesArray);

            // Formatting
            var coursesContainer = document.getElementById("CourseList");
            coursesContainer.innerHTML = "<h2>Course List:</h2>";

            if (coursesArray.length > 0) {
                // Loop through the coursesArray and display each course
                coursesArray.forEach(function (course) {
                    var courseDiv = document.createElement("div");
                    courseDiv.innerHTML = "<strong>Course Name: </strong> " + course.name +
                        "<br><strong>Books: </strong> " + formatBooks([course.book1, course.book2]) + "<br><br>";
                    coursesContainer.appendChild(courseDiv);
                });
            } else {
                // Display a message if there are no courses
                coursesContainer.innerHTML += "<p>No courses available.</p>";
            }

          }
        };

        request.open("GET", "test_server.php?requestType=getAllCourses");
        request.send();
      }

      /* Format book objects */
      function formatBooks(booksArray) {
          var formattedBooks = "<ul>";
          booksArray.forEach(function (book) {
              formattedBooks += "<li>Title: " + book.title + "</li><ul><li>Publisher: " + book.publisher + "</li><li>Edition: " + book.edition + "</li><li>Print Date:" + book.printDate + "</li></ul></li>";
          });
          formattedBooks += "</ul>";
          return formattedBooks;
      }

      // Add a course to courseArray list
      // Calls getAllCourses() to refresh
      function addCourse(theform) {
        var request = new XMLHttpRequest();
        request.open("GET", "test_server.php?requestType=addCourse" +
            "&course=" + theform.course.value +
            "&book1N=" + theform.book1N.value +
            "&book1P=" + theform.book1P.value +
            "&book1E=" + theform.book1E.value +
            "&pd1=" + theform.pd1.value +
            "&book2N=" + theform.book2N.value +
            "&book2P=" + theform.book2P.value +
            "&book2E=" + theform.book2E.value +
            "&pd2=" + theform.pd2.value
        );

        request.onreadystatechange = function () {
            if (request.readyState === 4 && request.status === 200) {
                // Parse the JSON response
                var courseObject = JSON.parse(request.responseText);

                // Now you can work with the courseObject as needed
                console.log(courseObject);
            }
        };

        console.log(request);
        request.send();

        getAllCourses();
      }

      /* STUDENT FUNCTIONS */

      // Clear all students in the session
      // Calls getAllStudents() to refresh
      function clearStudents() {
        var request = new XMLHttpRequest();
        request.open("GET", "test_server.php?requestType=clearStudents");

        request.onreadystatechange = function () {
          if (request.readyState == 4 && request.status == 200) {
              getAllStudents();
          }
        };

        console.log(request);
        request.send();
      }

      // Get all students in courseArray list
      function getAllStudents() {
        var request = new XMLHttpRequest();
        
        request.onreadystatechange = function () {
          if (request.readyState === 4 && request.status === 200) {
            // Parse the JSON response
            var studentsArray = JSON.parse(request.responseText);

            // Now you can work with the studentsArray as needed
            console.log(studentsArray);

            // Formatting
            var studentsContainer = document.getElementById("StudentList");
            studentsContainer.innerHTML = "<h2>Student List:</h2>";

            if (studentsArray.length > 0) {
                // Loop through the coursesArray and display each course
                studentsArray.forEach(function (student) {
                    var studentsDiv = document.createElement("div");
                    
                    if (!student.compliant) {
                      studentsDiv.style.backgroundColor = "yellow";
                    }
                    else {
                      studentsDiv.style.backgroundColor = "none";
                    }

                    studentsDiv.innerHTML = "<strong>Student Name: </strong> " + student.name + 
                        "<br><strong>Course Name: </strong> " + student.course +
                        "<br><strong>Compliant: </strong> " + student.compliant +
                        "<br><strong>Books: </strong> " + formatBooks([student.book1, student.book2]) + "<br><br>";
                    studentsContainer.appendChild(studentsDiv);
                });
            } else {
                // Display a message if there are no courses
                studentsContainer.innerHTML += "<p>No students available.</p>";
            }

          }
        };

        request.open("GET", "test_server.php?requestType=getAllStudents");
        request.send();
      }

      // Add a student to studentArray list
      // Calls getAllStudents() to refresh
      function addStudent(theform) {
        var request = new XMLHttpRequest();
        request.open("GET", "test_server.php?requestType=addStudent" +
            "&name=" + theform.name.value +
            "&course=" + theform.course.value +
            "&book1N=" + theform.book1N.value +
            "&book1P=" + theform.book1P.value +
            "&book1E=" + theform.book1E.value +
            "&pd1=" + theform.pd1.value +
            "&book2N=" + theform.book2N.value +
            "&book2P=" + theform.book2P.value +
            "&book2E=" + theform.book2E.value +
            "&pd2=" + theform.pd2.value
        );

        request.onreadystatechange = function () {
            if (request.readyState === 4 && request.status === 200) {
                // Parse the JSON response
                var studentObject = JSON.parse(request.responseText);

                // Now you can work with the courseObject as needed
                console.log(studentObject);
            }
        };

        console.log(request);
        request.send();

        getAllStudents();
      }

      /* VALIDATION */

      // Validate textbooks for each student
      function validateTextbooks() {
        var request = new XMLHttpRequest();
        
        request.onreadystatechange = function () {
          if (request.readyState === 4 && request.status === 200) {
            // Parse the JSON response
            getAllStudents();
          }
        };

        request.open("GET", "test_server.php?requestType=validate");
        request.send();
      }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

  <body>
</html>
